# TUI终端界面实施计划

**版本**: v2.0 TUI
**创建时间**: 2025-10-29
**预计完成**: 7天
**状态**: 🔄 进行中

---

## 📋 总体目标

基于现有CLI系统，创建交互式终端界面（TUI），让用户通过图形化界面使用所有功能。

### 核心价值
- ✅ 不需要记命令
- ✅ 可视化展示数据
- ✅ 交互式操作
- ✅ 更友好的用户体验

---

## 🏗️ 架构设计

### 技术栈
```
Textual 0.47+          # TUI框架
Rich 13.0+             # 已安装，文本渲染
Python 3.10+           # 运行环境
```

### 项目结构
```
ui/tui/
├── __init__.py
├── app.py                    # 主应用类
├── styles.css                # Textual样式
├── state.py                  # 应用状态管理
├── screens/                  # 界面屏幕
│   ├── __init__.py
│   ├── dashboard.py          # 主面板
│   ├── daily.py              # 每日推荐
│   ├── practice.py           # 练习答题
│   ├── diagnose.py           # 诊断测试
│   ├── report.py             # 学习报告
│   ├── scan.py               # 扫描试卷
│   └── students.py           # 学生管理
└── widgets/                  # 自定义组件
    ├── __init__.py
    ├── header.py             # 顶部栏
    ├── sidebar.py            # 侧边栏
    ├── footer.py             # 底部栏
    ├── student_card.py       # 学生信息卡片
    ├── stats_card.py         # 统计卡片
    ├── plan_card.py          # 推荐方案卡片
    ├── knowledge_point_list.py  # 知识点列表
    └── progress_chart.py     # 进度图表
```

---

## 📅 实施阶段

### ✅ 阶段0：准备工作
**状态**: ✅ 已完成
- [x] 安装Textual依赖
- [x] 创建项目目录结构
- [x] 编写实施计划文档

---

### ✅ 阶段1：基础框架（Day 1）
**状态**: ✅ 已完成
**预计时间**: 4-6小时
**实际时间**: 已完成

#### 1.1 创建核心文件 ✅

**文件1**: `ui/tui/__init__.py` ✅
- TUI模块初始化

**文件2**: `ui/tui/state.py` ✅
- 应用状态管理
- AppState类
- 学生档案加载
- 知识图谱加载

**文件3**: `ui/tui/styles.css` ✅
- Textual样式定义
- 全局样式、卡片样式、按钮样式等
- 约150行CSS

**文件4**: `ui/tui/app.py` ✅
- 主应用类LearningSystemApp
- 快捷键绑定
- 导航系统
- 约120行代码

#### 1.2 实现基础组件 ✅

**文件5**: `ui/tui/widgets/header.py` ✅
- 显示：标题、当前学生、日期时间
- 自动更新时间（每秒）
- 约30行代码

**文件6**: `ui/tui/widgets/sidebar.py` ✅
- 功能菜单列表（7个菜单项）
- 导航到不同界面
- 菜单高亮显示
- 约60行代码

**文件7**: `ui/tui/widgets/footer.py` ✅
- 快捷键提示
- 状态信息显示
- 约30行代码

**文件8**: `tui_app.py` ✅
- TUI入口文件
- 错误处理
- 约30行代码

#### 1.3 测试基础框架 ✅

**已创建文件**：
- ✅ 8个Python文件
- ✅ 1个CSS样式文件
- ✅ 约350行代码

**完成标准**：
- ✅ 项目结构完整
- ✅ 语法检查通过
- ✅ 可以导入运行（待测试）

---

### 🔲 阶段2：Dashboard主面板（Day 2）
**状态**: 🔲 待开始
**预计时间**: 4-6小时

#### 2.1 创建Dashboard界面

**文件8**: `ui/tui/screens/dashboard.py`

**布局**：
```
┌────────────────────────────────────────┐
│ 📊 今日概况                             │
│ ┌──────┬──────┬──────┬──────┐         │
│ │总题数 │错题数 │正确率 │实际水平│         │
│ │ 62   │ 32  │48.39%│2.3年级│         │
│ └──────┴──────┴──────┴──────┘         │
│                                        │
│ 🎯 今日推荐                             │
│ ┌────────────────────────────────────┐ │
│ │ ⭐ 基础补习 - 二年级乘法口诀          │ │
│ │ 📝 15道题 ⏱️ 20分钟 📊 难度：简单    │ │
│ │ [立即开始]                           │ │
│ └────────────────────────────────────┘ │
│                                        │
│ 🔴 薄弱知识点 Top 3                     │
│ 1. 乘法应用   0%   ████░░░░░░          │
│ 2. 加法应用   0%   ████░░░░░░          │
│ 3. 时间计算  33%   ███████░░░          │
│                                        │
│ ⚡ 快捷操作                             │
│ [D]诊断 [R]推荐 [P]练习 [A]分析        │
└────────────────────────────────────────┘
```

**组件需求**：

**文件9**: `ui/tui/widgets/student_card.py`
- 学生信息卡片
- 显示：姓名、年级、总体统计

**文件10**: `ui/tui/widgets/stats_card.py`
- 统计数据卡片（Grid布局）
- 4个统计项：总题数、错题、正确率、水平

**文件11**: `ui/tui/widgets/weak_points_list.py`
- 薄弱知识点列表
- 进度条显示
- 颜色编码（红/黄/绿）

#### 2.2 数据加载

**功能**：
- 加载学生档案
- 加载知识图谱
- 获取今日推荐
- 获取薄弱知识点

**完成标准**：
- ✅ Dashboard完整显示
- ✅ 数据正确加载
- ✅ 快捷键跳转工作
- ✅ 刷新数据功能

---

### 🔲 阶段3：每日推荐界面（Day 3）
**状态**: 🔲 待开始
**预计时间**: 4-6小时

#### 3.1 创建每日推荐界面

**文件12**: `ui/tui/screens/daily.py`

**布局**：
```
┌────────────────────────────────────────┐
│ 📅 今日推荐                    琪琪-数学 │
├────────────────────────────────────────┤
│                                        │
│ 请选择练习方案：                         │
│                                        │
│ ⭐ (•) 方案1: 🔧 基础补习                │
│     回溯到2年级，补习「乘法口诀7、8、9段」│
│     📊 15道题 | ⏱️ 20分钟 | 简单        │
│     🎯 打牢基础，为后续学习做准备         │
│     知识点：                            │
│       • 乘法口诀7、8、9段 (15题)        │
│     [详情] [开始练习]                   │
│                                        │
│ ( ) 方案2: 🎯 薄弱点突破                │
│     重点练习3个薄弱知识点                │
│     📊 15道题 | ⏱️ 20分钟              │
│     [展开]                              │
│                                        │
│ ( ) 方案3: 📚 全面复习                  │
│     📊 20道题 | ⏱️ 30分钟              │
│     [展开]                              │
│                                        │
│ ( ) 方案4: ⚡ 快速练习                  │
│     📊 10道题 | ⏱️ 10分钟              │
│     [展开]                              │
│                                        │
│ [Enter]开始练习 [Space]选择 [B]返回     │
└────────────────────────────────────────┘
```

**组件需求**：

**文件13**: `ui/tui/widgets/plan_card.py`
- 推荐方案卡片
- 可展开/折叠
- 单选功能
- 高亮推荐方案

#### 3.2 交互逻辑

**功能**：
- ↑↓ 键选择方案
- Space/Enter 选中
- 展开查看详情
- 开始练习跳转

**完成标准**：
- ✅ 显示所有推荐方案
- ✅ 可选择方案
- ✅ 详情展开工作
- ✅ 跳转到练习界面

---

### 🔲 阶段4：练习答题界面（Day 4）
**状态**: 🔲 待开始
**预计时间**: 6-8小时（最复杂）

#### 4.1 创建练习界面

**文件14**: `ui/tui/screens/practice.py`

**布局**：
```
┌────────────────────────────────────────┐
│ ✍️ 练习中   进度: 3/15   用时: 00:05:23  │
├────────────────────────────────────────┤
│                                        │
│ 知识点: 乘法口诀7、8、9段                │
│ 难度: ★★☆☆☆                            │
│                                        │
│ 第3题：                                 │
│ ┌────────────────────────────────────┐ │
│ │                                    │ │
│ │ 小明买了7个苹果，每个苹果8元，      │ │
│ │ 一共需要多少元？                    │ │
│ │                                    │ │
│ └────────────────────────────────────┘ │
│                                        │
│ 你的答案：                              │
│ ┌────────────────────────────────────┐ │
│ │ > _                                │ │
│ └────────────────────────────────────┘ │
│                                        │
│ [Enter]提交 [S]跳过 [H]提示 [Q]退出     │
│                                        │
│ 已完成: ████░░░░░░░░░░░                │
│ ✅ 正确: 2题  ❌ 错误: 0题               │
│                                        │
└────────────────────────────────────────┘
```

**答题后反馈界面**：
```
┌────────────────────────────────────────┐
│ ✅ 回答正确！                            │
│                                        │
│ 你的答案: 56元                          │
│ 正确答案: 56元                          │
│                                        │
│ 💡 解析：                               │
│ 7 × 8 = 56（元）                       │
│                                        │
│ [Enter]下一题 [R]查看详解               │
└────────────────────────────────────────┘
```

**练习结束界面**：
```
┌────────────────────────────────────────┐
│ 🎉 练习完成！                            │
│                                        │
│ 📊 本次练习统计                          │
│ ┌──────────────────────────────────┐   │
│ │ 总题数:    15道                   │   │
│ │ 正确:      12道                   │   │
│ │ 错误:       3道                   │   │
│ │ 正确率:    80%  ████████░░        │   │
│ │ 用时:      18分32秒                │   │
│ └──────────────────────────────────┘   │
│                                        │
│ 🎯 知识点掌握情况                        │
│ • 乘法口诀7段: 100% ✅                   │
│ • 乘法口诀8段:  80% ⚠️                   │
│ • 乘法口诀9段:  60% 🔴 需要加强          │
│                                        │
│ 💡 建议：                               │
│ 9的口诀还不够熟练，建议明天再练习5道       │
│                                        │
│ [Enter]返回 [R]再练一次 [V]查看错题      │
└────────────────────────────────────────┘
```

#### 4.2 功能实现

**核心功能**：
- 题目显示（支持多行）
- 答案输入框
- 答案验证
- 即时反馈（对/错）
- 计时器
- 进度追踪
- 结束总结

**交互**：
- 输入答案 + Enter提交
- S键跳过
- H键查看提示
- Q键退出（确认）

**数据保存**：
- 练习记录
- 错题收集
- 更新学生档案

**完成标准**：
- ✅ 完整的答题流程
- ✅ 计时器工作
- ✅ 答案验证准确
- ✅ 即时反馈清晰
- ✅ 数据正确保存

---

### 🔲 阶段5：诊断测试界面（Day 5）
**状态**: 🔲 待开始
**预计时间**: 4-5小时

#### 5.1 创建诊断界面

**文件15**: `ui/tui/screens/diagnose.py`

**诊断中界面**：
```
┌────────────────────────────────────────┐
│ 🔍 诊断测试                     琪琪-数学 │
├────────────────────────────────────────┤
│                                        │
│ 正在分析学习数据...                     │
│                                        │
│ ████████████████░░░░  80%              │
│                                        │
│ 当前阶段: 分析知识点掌握情况             │
│                                        │
└────────────────────────────────────────┘
```

**诊断结果界面**：
```
┌────────────────────────────────────────┐
│ 🔍 诊断结果                     琪琪-数学 │
├────────────────────────────────────────┤
│                                        │
│ 📊 综合评估                             │
│ ┌──────────────────────────────────┐   │
│ │ 目标年级: 3年级                   │   │
│ │ 实际水平: 2.3年级  ⚠️ 基础薄弱    │   │
│ │                                  │   │
│ │ 掌握情况: ████████░░░░░░░░░░ 48% │   │
│ └──────────────────────────────────┘   │
│                                        │
│ 🔴 需要补习的前置知识点（根本原因）      │
│ ┌──────────────────────────────────┐   │
│ │ 1. [2年级] 乘法口诀7、8、9段       │   │
│ │    重要性: ★★★★★                  │   │
│ │    [开始补习]                      │   │
│ │                                  │   │
│ │ 2. [2年级] 除法的意义              │   │
│ │    重要性: ★★★★★                  │   │
│ │    [开始补习]                      │   │
│ └──────────────────────────────────┘   │
│                                        │
│ 💡 学习建议                             │
│ ┌──────────────────────────────────┐   │
│ │【高优先级】                        │   │
│ │ 优先补习二年级乘法口诀，这是当前   │   │
│ │ 薄弱环节的根本原因                 │   │
│ │                                  │   │
│ │ 建议学习路径：                     │   │
│ │ 1. 二年级乘法口诀 (2周)            │   │
│ │ 2. 三年级多位数乘法 (2周)          │   │
│ │ 3. 三年级乘法应用 (2周)            │   │
│ └──────────────────────────────────┘   │
│                                        │
│ [Enter]查看详细报告 [P]开始补习 [B]返回 │
└────────────────────────────────────────┘
```

#### 5.2 功能实现

**核心功能**：
- 调用诊断系统
- 结果可视化
- 学习路径展示
- 一键开始补习

**完成标准**：
- ✅ 诊断流程完整
- ✅ 结果展示清晰
- ✅ 跳转补习功能

---

### 🔲 阶段6：学习报告界面（Day 6）
**状态**: 🔲 待开始
**预计时间**: 3-4小时

#### 6.1 创建报告界面

**文件16**: `ui/tui/screens/report.py`

**布局**：
```
┌────────────────────────────────────────┐
│ 📊 学习报告                     琪琪-数学 │
├────────────────────────────────────────┤
│                                        │
│ 📈 总体统计                             │
│ ┌──────────────────────────────────┐   │
│ │ 测试次数: 3次                     │   │
│ │ 累计题数: 62道                    │   │
│ │ 总体正确率: 48.39%                │   │
│ │ 学习趋势: 📈 进步中               │   │
│ └──────────────────────────────────┘   │
│                                        │
│ 📚 知识点掌握情况              [展开▼]  │
│ ┌──────────────────────────────────┐   │
│ │ 🔴 需要加强 (3个)                 │   │
│ │ • 乘法应用     0%  ████░░░░░░     │   │
│ │ • 加法应用     0%  ████░░░░░░     │   │
│ │ • 时间计算    33%  ███████░░░     │   │
│ │                                  │   │
│ │ 🟢 掌握良好 (8个)         [查看]  │   │
│ └──────────────────────────────────┘   │
│                                        │
│ 📝 题型分析                    [展开▼]  │
│ ┌──────────────────────────────────┐   │
│ │ 应用题  47%  需加强               │   │
│ │ 计算题  73%  良好                 │   │
│ │ 填空题  65%  一般                 │   │
│ └──────────────────────────────────┘   │
│                                        │
│ 🤖 AI分析建议              ↕️滚动查看   │
│ ┌──────────────────────────────────┐   │
│ │ 琪琪在基础计算方面表现不错...      │   │
│ │ (可滚动查看完整内容)              │   │
│ └──────────────────────────────────┘   │
│                                        │
│ [E]导出HTML [P]打印 [B]返回            │
└────────────────────────────────────────┘
```

**功能**：
- 数据表格显示
- 可折叠/展开
- 滚动查看长文本
- 导出HTML报告

**完成标准**：
- ✅ 完整数据展示
- ✅ 交互流畅
- ✅ 导出功能工作

---

### 🔲 阶段7：辅助功能（Day 7）
**状态**: 🔲 待开始
**预计时间**: 4-6小时

#### 7.1 学生管理界面

**文件17**: `ui/tui/screens/students.py`

**功能**：
- 学生列表
- 添加新学生
- 删除学生
- 切换当前学生
- 查看学生详情

#### 7.2 扫描试卷界面

**文件18**: `ui/tui/screens/scan.py`

**功能**：
- 选择图片目录
- 显示扫描进度
- 实时显示识别结果
- 导入题库

#### 7.3 设置界面

**文件19**: `ui/tui/screens/settings.py`

**功能**：
- API密钥配置
- 默认参数设置
- 主题切换（深色/浅色）
- 快捷键自定义

---

## 🎨 样式系统

### styles.css 完整定义

```css
/* 全局样式 */
Screen {
    background: $surface;
}

/* 布局 */
.container {
    width: 100%;
    height: 100%;
}

.main-content {
    width: 1fr;
    height: 1fr;
}

/* 组件样式 */
.card {
    background: $panel;
    border: solid $primary;
    padding: 1 2;
    margin: 1;
}

.card-title {
    text-style: bold;
    color: $text;
}

/* 推荐方案 */
.plan-recommended {
    background: $success 20%;
    border: heavy $success;
}

.plan-selected {
    border: heavy $primary;
    background: $primary 10%;
}

.plan-normal {
    border: solid $panel;
}

/* 进度条 */
.progress-excellent {
    color: $success;
}

.progress-good {
    color: $info;
}

.progress-average {
    color: $warning;
}

.progress-weak {
    color: $danger;
}

/* 按钮 */
.button-primary {
    background: $primary;
    color: $text;
}

.button-success {
    background: $success;
}

.button-danger {
    background: $danger;
}

/* 快捷键提示 */
.keybinding {
    color: $accent;
    text-style: bold;
}
```

---

## 🔧 核心组件详细设计

### 1. Header组件
```python
class Header(Static):
    """顶部栏"""

    def compose(self):
        yield Label("🎓 智能学习系统 v2.0")
        yield Label(f"学生: {self.app.state.current_student}")
        yield Label(datetime.now().strftime("%Y-%m-%d %H:%M"))
```

### 2. Sidebar组件
```python
class Sidebar(Container):
    """侧边导航栏"""

    MENU_ITEMS = [
        ("🏠", "dashboard", "主页"),
        ("📅", "daily", "今日推荐"),
        ("🔍", "diagnose", "诊断测试"),
        ("📊", "report", "学习报告"),
        ("📷", "scan", "扫描试卷"),
        ("👥", "students", "学生管理"),
        ("⚙️", "settings", "设置"),
    ]

    def on_button_pressed(self, event):
        # 切换屏幕
        self.app.push_screen(event.button.id)
```

### 3. 数据卡片组件
```python
class StatsCard(Static):
    """统计卡片"""

    def __init__(self, title, value, icon="📊"):
        self.title = title
        self.value = value
        self.icon = icon

    def render(self):
        return Panel(
            f"{self.icon} {self.title}\n\n[bold]{self.value}[/bold]",
            border_style="primary"
        )
```

---

## 🎮 交互设计

### 全局快捷键
```python
BINDINGS = [
    ("q", "quit", "退出"),
    ("h", "help", "帮助"),
    ("ctrl+s", "switch_student", "切换学生"),
    ("ctrl+r", "refresh", "刷新数据"),
    ("d", "push_screen('diagnose')", "诊断"),
    ("r", "push_screen('daily')", "推荐"),
    ("p", "start_practice", "练习"),
]
```

### 界面导航流程
```
Dashboard (主页)
    ↓ [D] 或点击"诊断"
Diagnose (诊断测试)
    ↓ [P] 或点击"开始补习"
Daily (每日推荐)
    ↓ [Enter] 选择方案
Practice (练习答题)
    ↓ 完成练习
Dashboard (返回主页，查看进步)
```

---

## 📦 依赖更新

### requirements.txt 新增
```txt
# TUI框架
textual>=0.47.0
textual-dev>=1.3.0  # 开发工具（可选）
```

---

## 🧪 测试计划

### 单元测试
```
tests/tui/
├── test_widgets.py      # 组件测试
├── test_screens.py      # 界面测试
└── test_navigation.py   # 导航测试
```

### 功能测试清单
- [ ] 启动应用
- [ ] 导航切换
- [ ] 数据加载
- [ ] 练习流程
- [ ] 数据保存
- [ ] 快捷键
- [ ] 错误处理

---

## 📊 进度追踪

### 总体进度
- 总文件数: 19个
- 总代码量: ~2500行
- 预计时间: 7天

### 阶段进度
| 阶段 | 状态 | 文件数 | 预计时间 | 实际时间 | 备注 |
|------|------|--------|---------|---------|------|
| 0. 准备 | ✅ 完成 | 2 | 0.5h | - | 已完成 |
| 1. 基础框架 | 🔲 待开始 | 7 | 4-6h | - | - |
| 2. Dashboard | 🔲 待开始 | 4 | 4-6h | - | - |
| 3. 每日推荐 | 🔲 待开始 | 2 | 4-6h | - | - |
| 4. 练习答题 | 🔲 待开始 | 1 | 6-8h | - | 最复杂 |
| 5. 诊断测试 | 🔲 待开始 | 1 | 4-5h | - | - |
| 6. 学习报告 | 🔲 待开始 | 1 | 3-4h | - | - |
| 7. 辅助功能 | 🔲 待开始 | 3 | 4-6h | - | - |

---

## 🎯 里程碑

### Milestone 1: 基础可用（Day 1-2）
- ✅ 应用可启动
- ✅ 基础导航工作
- ✅ Dashboard显示

### Milestone 2: 核心功能（Day 3-5）
- ✅ 每日推荐工作
- ✅ 可以完成练习
- ✅ 诊断测试可用

### Milestone 3: 完整系统（Day 6-7）
- ✅ 所有界面完成
- ✅ 辅助功能齐全
- ✅ 测试通过

---

## 🚀 下一步行动

### 立即开始：阶段1
1. 创建ui/tui目录结构
2. 创建app.py主应用
3. 创建styles.css样式
4. 创建基础组件（Header/Sidebar/Footer）
5. 实现Dashboard骨架
6. 测试运行

**开始命令**：
```bash
# 创建项目结构
mkdir -p ui/tui/{screens,widgets}

# 创建__init__.py文件
# 创建app.py主应用
# ...
```

---

## 📝 开发规范

### 代码风格
- 使用Type Hints
- 完整的Docstrings
- 清晰的注释
- 遵循Textual最佳实践

### 命名规范
- Screen类：XXXScreen（如DashboardScreen）
- Widget类：XXXWidget（如StatsCardWidget）
- 文件名：小写下划线（如student_card.py）

### Git提交
每完成一个阶段提交一次：
```
git add .
git commit -m "feat(tui): 完成阶段X - XXX功能"
git push
```

---

准备就绪，开始实施！🚀